<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.irelandlight.dao.ShopCarDao">

    <!--添加用户购物车(ShopCar)-->
    <insert id="insertShopCarByShopCar" parameterType="com.irelandlight.model.ShopCar">
        <!-- 返回自增主键 -->
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
        <!-- 增加用户购物车 -->
        INSERT INTO tb_shop_car (consumer_id)
        VALUES
            (#{consumerId})
    </insert>

    <!--添加用户购物车(用户id) 返回主键 -->
    <insert id="insertShopCarByConsumerId" parameterType="java.lang.Long">
        <!-- 返回自增主键 -->
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
        <!-- 增加用户购物车 -->
        INSERT INTO tb_shop_car (consumer_id) VALUES (#{consumerId})
    </insert>

    <!--删除用户购物车-->
    <update id="deleteConsumerShopCarByConsumerId" parameterType="java.lang.Long">
        UPDATE tb_shop_car
        SET tb_shop_car.visibility = 1
        WHERE
            tb_shop_car.consumer_id = #{consumerId};
    </update>

    <!--暂不提供修改用户购物车功能-->

    <!--通过用户Id查询其购物车信息-->
    <select id="findShopCarDetailByConsumerId" parameterType="java.lang.Long" resultType="com.irelandlight.model.ShopCar">
        SELECT *
        FROM tb_shop_car
        WHERE
            tb_shop_car.visibility = 0 AND tb_shop_car.consumer_id = #{consumerId}
    </select>

</mapper>